<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Analytics Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>Student Performance Analytics Dashboard</h1>
            <p class="subtitle">Undergraduate Programmes &mdash; All Academic Years</p>

            <div class="header-stats" id="headerStats">
                <div class="stat-card">
                    <span class="stat-value" id="totalApplicants">-</span>
                    <span class="stat-label">Total Applicants</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="registeredStudents">-</span>
                    <span class="stat-label">Registered Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="avgGPA">-</span>
                    <span class="stat-label">Average GPA (0-22)</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="avgAttendance">-</span>
                    <span class="stat-label">Avg Attendance</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="completionRate">-</span>
                    <span class="stat-label">Completion Rate</span>
                </div>
            </div>
        </header>

        <section class="import-section" id="importSection">
            <div class="import-header" id="importToggle">
                <h2>Import Data</h2>
                <span class="import-hint">Upload custom CSV files to analyse your own data</span>
                <button class="btn btn-sm btn-toggle collapsed" id="importToggleBtn" aria-label="Toggle import panel">
                    <span class="toggle-icon">&#9660;</span>
                </button>
            </div>
            <div class="import-body collapsed" id="importBody">
                <p class="import-instructions">Select all 6 CSV files, then click <strong>Load Imported Data</strong>. Each file must contain the required columns for its data type.</p>
                <div class="import-grid">
                    <div class="import-item">
                        <label for="fileAdmissions">01 — Admissions</label>
                        <input type="file" id="fileAdmissions" accept=".csv" data-key="admissions">
                    </div>
                    <div class="import-item">
                        <label for="fileCurrentStudents">02 — Current Students</label>
                        <input type="file" id="fileCurrentStudents" accept=".csv" data-key="currentStudents">
                    </div>
                    <div class="import-item">
                        <label for="fileEnrollments">03 — Course Enrolments</label>
                        <input type="file" id="fileEnrollments" accept=".csv" data-key="enrollments">
                    </div>
                    <div class="import-item">
                        <label for="fileAttendance">04 — Attendance</label>
                        <input type="file" id="fileAttendance" accept=".csv" data-key="attendance">
                    </div>
                    <div class="import-item">
                        <label for="fileClassifications">05 — Degree Classifications</label>
                        <input type="file" id="fileClassifications" accept=".csv" data-key="classifications">
                    </div>
                    <div class="import-item">
                        <label for="fileCourseResults">06 — Course Results</label>
                        <input type="file" id="fileCourseResults" accept=".csv" data-key="courseResults">
                    </div>
                </div>
                <div class="import-progress" id="importProgress" style="display:none;">
                    <div class="import-progress-bar"><div class="import-progress-fill" id="importProgressFill"></div></div>
                    <p class="import-progress-text" id="importProgressText">Loading...</p>
                </div>
                <div class="import-error" id="importError" style="display:none;"></div>
                <div class="import-actions">
                    <button class="btn btn-primary" id="loadImportedData" disabled>Load Imported Data</button>
                    <button class="btn btn-secondary" id="resetToDefault">Reset to Default Data</button>
                </div>
            </div>
        </section>

        <section class="management-overview" id="managementOverview">
            <h2>Management Overview</h2>
            <p class="overview-subtitle">Strategic KPIs across all applicants — updates automatically as new data is added</p>
            <div class="overview-grid">
                <div class="chart-card">
                    <h3>Recruitment Sources</h3>
                    <canvas id="recruitmentSourceChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Recruitment Source Effectiveness</h3>
                    <canvas id="recruitmentEffectivenessChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Admissions Conversion Funnel</h3>
                    <canvas id="offerFunnelChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Degree Classification by Programme</h3>
                    <canvas id="classificationByProgChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Attendance Risk Overview</h3>
                    <canvas id="attendanceRiskChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Education System Performance</h3>
                    <canvas id="educationPerformanceChart"></canvas>
                </div>
            </div>
            <div class="overview-grid overview-grid-wide">
                <div class="chart-card">
                    <h3>New vs Returning Students by Academic Year</h3>
                    <canvas id="newReturningChart"></canvas>
                </div>
            </div>
            <div class="programme-key">
                <p class="key-title">Programme Abbreviations</p>
                <span class="key-item"><strong>AF</strong> Accountancy &amp; Finance</span>
                <span class="key-item"><strong>BM</strong> Business Management</span>
                <span class="key-item"><strong>BM-IS</strong> BM &amp; Information Systems</span>
                <span class="key-item"><strong>BM-IR</strong> BM &amp; International Relations</span>
                <span class="key-item"><strong>CS</strong> Computing Science</span>
                <span class="key-item"><strong>LS</strong> Legal Studies</span>
                <span class="key-item"><strong>PIR</strong> Politics &amp; International Relations</span>
            </div>
            <div class="data-table-container" id="recruitmentTable"></div>
        </section>

        <section class="query-panel" id="queryPanel">
            <div class="query-panel-header">
                <h2>Filter Data</h2>
                <span class="filter-count" id="filterCount"></span>
                <button class="btn btn-sm btn-toggle collapsed" id="toggleFilters" aria-label="Toggle filters">
                    <span class="toggle-icon">&#9660;</span>
                </button>
            </div>

            <div class="filters-body collapsed" id="filtersBody">
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterYear">Academic Year</label>
                        <select id="filterYear">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterSchool">School</label>
                        <select id="filterSchool">
                            <option value="">All Schools</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterProgramme">Programme</label>
                        <select id="filterProgramme">
                            <option value="">All Programmes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterGender">Gender</label>
                        <select id="filterGender">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterNationality">Nationality</label>
                        <select id="filterNationality">
                            <option value="">All Nationalities</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterAttendance">Attendance Status</label>
                        <select id="filterAttendance">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterClassification">Degree Classification</label>
                        <select id="filterClassification">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterEntryLevel">Entry Level</label>
                        <select id="filterEntryLevel">
                            <option value="">All</option>
                        </select>
                    </div>
                </div>

                <div class="filters-row-2">
                    <div class="filter-group filter-range">
                        <label>GPA Range (0-22)</label>
                        <div class="range-inputs">
                            <input type="number" id="gpaMin" placeholder="Min" min="0" max="22" step="0.5">
                            <span class="range-sep">&ndash;</span>
                            <input type="number" id="gpaMax" placeholder="Max" min="0" max="22" step="0.5">
                        </div>
                    </div>
                    <div class="filter-group filter-search">
                        <label for="searchInput">Search</label>
                        <input type="text" id="searchInput" placeholder="Student name or ID...">
                    </div>
                </div>

                <div class="filter-chips" id="filterChips"></div>

                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    <button class="btn btn-secondary" id="resetFilters">Reset</button>
                    <button class="btn btn-secondary" id="exportData">Export CSV</button>
                </div>
            </div>
        </section>

        <nav class="tabs" role="tablist">
            <button class="tab active" data-tab="enrollment" role="tab">Enrollment Trends</button>
            <button class="tab" data-tab="performance" role="tab">Academic Performance</button>
            <button class="tab" data-tab="comparison" role="tab">Programme Comparison</button>
            <button class="tab" data-tab="retention" role="tab">Retention & Attrition</button>
            <button class="tab" data-tab="demographics" role="tab">Demographics</button>
            <button class="tab" data-tab="insights" role="tab">Insights</button>
        </nav>

        <!-- Enrollment -->
        <div id="enrollmentSection" class="content-section active" role="tabpanel">
            <h2 class="section-title">Enrollment Trends Analysis</h2>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <h3>Enrollment Over Time</h3>
                    <canvas id="enrollmentTrendChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Enrollment by School</h3>
                    <canvas id="enrollmentBySchoolChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Enrollment by Programme</h3>
                    <canvas id="enrollmentByProgrammeChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="enrollmentTable"></div>
        </div>

        <!-- Performance -->
        <div id="performanceSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Academic Performance Analysis</h2>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Degree Classification Distribution</h3>
                    <canvas id="gpaDistributionChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Pass/Fail Rates by Programme</h3>
                    <canvas id="passRateChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Average GPA by Programme</h3>
                    <canvas id="avgGPAChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Grade Distribution (CGS)</h3>
                    <canvas id="gradeDistChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="performanceTable"></div>
        </div>

        <!-- Comparison -->
        <div id="comparisonSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Programme Comparison</h2>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Completion Rates by Programme</h3>
                    <canvas id="completionRatesChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Programme Performance Matrix</h3>
                    <canvas id="performanceMatrixChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="comparisonTable"></div>
        </div>

        <!-- Retention -->
        <div id="retentionSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Retention & Attrition</h2>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <h3>Retention Rate Over Time</h3>
                    <canvas id="retentionRateChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Attrition Rate by School</h3>
                    <canvas id="attritionRateChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Completion Rate by Cohort</h3>
                    <canvas id="cohortCompletionChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="retentionTable"></div>
        </div>

        <!-- Demographics -->
        <div id="demographicsSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Demographics</h2>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Gender Distribution</h3>
                    <canvas id="genderDistChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top 10 Nationalities</h3>
                    <canvas id="nationalityChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Age Distribution</h3>
                    <canvas id="ageDistChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>English Proficiency Levels</h3>
                    <canvas id="proficiencyChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="demographicsTable"></div>
        </div>

        <!-- Insights -->
        <div id="insightsSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Insights & Recommendations</h2>
            <div id="enrollmentInsights" class="insights-container"></div>
            <div id="performanceInsights" class="insights-container"></div>
            <div id="retentionInsights" class="insights-container"></div>
            <div id="demographicInsights" class="insights-container"></div>
            <div id="strategicRecommendations" class="insights-container"></div>
        </div>

        <footer class="dashboard-footer">
            <p>MSc Data Science Project | Student Performance Analytics</p>
        </footer>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Loading dashboard...</p>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/dataLoader.js"></script>
    <script src="js/dataStore.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/tables.js"></script>
    <script src="js/queryPanel.js"></script>
    <script src="js/insights.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
