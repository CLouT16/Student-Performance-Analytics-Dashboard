<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Analytics Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>Student Performance Analytics Dashboard</h1>
            <p class="subtitle">Undergraduate Programmes &mdash; All Academic Years</p>

            <div class="header-stats" id="headerStats">
                <div class="stat-card">
                    <span class="stat-value" id="totalApplicants">-</span>
                    <span class="stat-label">Total Applicants</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="registeredStudents">-</span>
                    <span class="stat-label">Registered Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="avgGPA">-</span>
                    <span class="stat-label">Avg Grade Point (0-22)</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="avgAttendance">-</span>
                    <span class="stat-label">Avg Attendance</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="completionRate">-</span>
                    <span class="stat-label">Completion Rate</span>
                </div>
            </div>
        </header>

        <section class="import-section" id="importSection">
            <div class="import-header" id="importToggle">
                <h2>Import Data</h2>
                <span class="import-hint">Upload custom CSV files to analyse your own data</span>
                <button class="btn btn-sm btn-toggle collapsed" id="importToggleBtn" aria-label="Toggle import panel">
                    <span class="toggle-icon">&#9660;</span>
                </button>
            </div>
            <div class="import-body collapsed" id="importBody">
                <p class="import-instructions">Select a file type from the dropdown, then choose the corresponding CSV file. Repeat for all 6 files, then click <strong>Load Imported Data</strong>.</p>
                <div class="import-upload-row">
                    <select id="importFileType">
                        <option value="">— Select file type —</option>
                        <option value="admissions">01 — Admissions</option>
                        <option value="currentStudents">02 — Current Students</option>
                        <option value="enrollments">03 — Course Enrolments</option>
                        <option value="attendance">04 — Attendance</option>
                        <option value="classifications">05 — Degree Classifications</option>
                        <option value="courseResults">06 — Course Results</option>
                    </select>
                    <input type="file" id="importFileInput" accept=".csv">
                </div>
                <div class="import-progress" id="importProgress" style="display:none;">
                    <div class="import-progress-bar"><div class="import-progress-fill" id="importProgressFill"></div></div>
                    <p class="import-progress-text" id="importProgressText">Loading...</p>
                </div>
                <div class="import-error" id="importError" style="display:none;"></div>
                <div class="import-actions">
                    <button class="btn btn-primary" id="loadImportedData" disabled>Load Imported Data</button>
                    <button class="btn btn-secondary" id="resetToDefault">Reset to Default Data</button>
                </div>
            </div>
        </section>

        <section class="management-overview" id="managementOverview">
            <div class="management-overview-header" id="managementOverviewToggle">
                <div>
                    <h2>Management Overview</h2>
                    <p class="overview-subtitle">Strategic KPIs across all applicants — updates automatically as new data is added</p>
                </div>
                <button class="btn btn-sm btn-toggle" id="managementOverviewToggleBtn" aria-label="Toggle management overview">
                    <span class="toggle-icon">&#9660;</span>
                </button>
            </div>
            <div class="management-overview-body" id="managementOverviewBody">
            <div class="overview-grid">
                <div class="chart-card">
                    <h3>Recruitment Sources</h3>
                    <canvas id="recruitmentSourceChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Recruitment Source Effectiveness</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="recruitmentEffectiveness" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="recruitmentEffectiveness" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="recruitmentEffectivenessChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Admissions Pipeline</h3>
                    <canvas id="offerFunnelChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Degree Classification by Programme</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="classificationByProg" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="classificationByProg" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <div class="chart-prog-filter" id="classificationProgFilter"></div>
                    <canvas id="classificationByProgChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Attendance Risk Overview</h3>
                    <canvas id="attendanceRiskChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Prior Education System — Student Count</h3>
                    <canvas id="educationPerformanceChart"></canvas>
                </div>
            </div>
            <div class="overview-grid overview-grid-wide">
                <div class="chart-card">
                    <h3>New vs Returning Students by Academic Year</h3>
                    <canvas id="newReturningChart"></canvas>
                </div>
            </div>
            <div class="overview-grid overview-grid-wide">
                <div class="chart-card">
                    <h3>Student Flow — Applicant Journey</h3>
                    <div id="sankeyChart" class="plotly-container"></div>
                </div>
            </div>
            <div class="data-table-container" id="recruitmentTable"></div>
            </div>
        </section>

        <section class="query-panel" id="queryPanel">
            <div class="query-panel-header">
                <h2>Filter Data</h2>
                <span class="filter-count" id="filterCount"></span>
                <button class="btn btn-sm btn-toggle collapsed" id="toggleFilters" aria-label="Toggle filters">
                    <span class="toggle-icon">&#9660;</span>
                </button>
            </div>

            <div class="filters-body collapsed" id="filtersBody">
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterYear">Academic Year</label>
                        <select id="filterYear">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterSchool">School</label>
                        <select id="filterSchool">
                            <option value="">All Schools</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterProgramme">Programme</label>
                        <select id="filterProgramme">
                            <option value="">All Programmes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterGender">Gender</label>
                        <select id="filterGender">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterNationality">Nationality</label>
                        <select id="filterNationality">
                            <option value="">All Nationalities</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterAttendance">Attendance Status</label>
                        <select id="filterAttendance">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterClassification">Degree Classification *</label>
                        <select id="filterClassification">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterEntryLevel">Entry Level</label>
                        <select id="filterEntryLevel">
                            <option value="">All</option>
                        </select>
                    </div>
                </div>

                <div class="filters-row-2">
                    <div class="filter-group filter-search">
                        <label for="searchInput">Search</label>
                        <input type="text" id="searchInput" placeholder="Student name or ID...">
                    </div>
                </div>

                <div class="filter-chips" id="filterChips"></div>

                <div class="filter-actions">
                    <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    <button class="btn btn-secondary" id="resetFilters">Reset</button>
                    <button class="btn btn-secondary" id="exportData">Export CSV</button>
                    <button class="btn btn-secondary" id="exportPDF">Export PDF</button>
                </div>
            </div>
        </section>

        <nav class="tabs" role="tablist">
            <button class="tab active" data-tab="enrollment" role="tab">Enrollment Trends</button>
            <button class="tab" data-tab="performance" role="tab">Academic Performance *</button>
            <button class="tab" data-tab="comparison" role="tab">Programme Comparison</button>
            <button class="tab" data-tab="retention" role="tab">Retention & Attrition</button>
            <button class="tab" data-tab="demographics" role="tab">Demographics</button>
            <button class="tab" data-tab="insights" role="tab">Insights</button>
            <button class="tab" data-tab="assistant" role="tab">AI Assistant</button>
        </nav>

        <!-- Enrollment -->
        <div id="enrollmentSection" class="content-section active" role="tabpanel">
            <h2 class="section-title">Enrollment Trends Analysis</h2>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <h3>Enrollment Over Time</h3>
                    <canvas id="enrollmentTrendChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Enrollment by School</h3>
                    <canvas id="enrollmentBySchoolChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Enrollment by Programme</h3>
                    <canvas id="enrollmentByProgrammeChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="enrollmentTable"></div>
        </div>

        <!-- Performance -->
        <div id="performanceSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Academic Performance Analysis *</h2>
            <p class="section-footnote">* Final degree classifications and academic decisions are subject to the Board of Examiners&rsquo; recommendations. Figures shown are based on recorded data prior to any board adjustments.</p>
            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Degree Classification Distribution</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="gpaDistribution" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="gpaDistribution" data-mode="byProgramme">By Programme</button>
                            <button class="chart-toggle" data-chart="gpaDistribution" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="gpaDistributionChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Pass/Fail Rates by Programme</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="passRate" data-mode="normalized">100%</button>
                            <button class="chart-toggle" data-chart="passRate" data-mode="absolute">Count</button>
                        </div>
                    </div>
                    <canvas id="passRateChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Average Grade Point by Programme</h3>
                    <canvas id="avgGPAChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Grade Distribution (Common Grading Scale)</h3>
                    <canvas id="gradeDistChart"></canvas>
                </div>
            </div>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <div class="chart-header-row">
                        <h3>Course Pass Rates</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="coursePassRate" data-mode="bottom10">Bottom 10</button>
                            <button class="chart-toggle" data-chart="coursePassRate" data-mode="top10">Top 10</button>
                            <button class="chart-toggle" data-chart="coursePassRate" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <div class="chart-prog-filter" id="coursePassRateFilter"></div>
                    <canvas id="coursePassRateChart"></canvas>
                </div>
            </div>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <h3>Classification Hierarchy — All Graduates by School / Programme / Classification</h3>
                    <div id="sunburstChart" class="plotly-container"></div>
                </div>
            </div>
            <div class="data-table-container" id="performanceTable"></div>
        </div>

        <!-- Comparison -->
        <div id="comparisonSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Programme Comparison</h2>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Completion Rates by Programme</h3>
                    <canvas id="completionRatesChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Grade Band Distribution by Programme</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="performanceMatrix" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="performanceMatrix" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <div class="chart-prog-filter" id="perfMatrixProgFilter"></div>
                    <canvas id="performanceMatrixChart"></canvas>
                </div>
            </div>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <div class="chart-header-row">
                        <h3>Programme Metrics Comparison</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="programmeComparison" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="programmeComparison" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="programmeComparisonChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="comparisonTable"></div>
        </div>

        <!-- Retention -->
        <div id="retentionSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Retention & Attrition</h2>
            <div class="chart-grid">
                <div class="chart-card chart-full">
                    <div class="chart-header-row">
                        <h3>Retention & Attrition Rates by Programme</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="retentionRate" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="retentionRate" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="retentionRateChart"></canvas>
                </div>
                <div class="chart-card chart-full">
                    <div class="chart-header-row">
                        <h3>Completion Rate by Cohort</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="cohortCompletion" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="cohortCompletion" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="cohortCompletionChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="retentionTable"></div>
        </div>

        <!-- Demographics -->
        <div id="demographicsSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Demographics</h2>
            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>Gender Distribution</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="genderDist" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="genderDist" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="genderDistChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top 10 Nationalities</h3>
                    <canvas id="nationalityChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Age Distribution</h3>
                    <canvas id="ageDistChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-header-row">
                        <h3>English Proficiency Levels</h3>
                        <div class="chart-toggles">
                            <button class="chart-toggle active" data-chart="proficiency" data-mode="absolute">Count</button>
                            <button class="chart-toggle" data-chart="proficiency" data-mode="normalized">100%</button>
                        </div>
                    </div>
                    <canvas id="proficiencyChart"></canvas>
                </div>
            </div>
            <div class="data-table-container" id="demographicsTable"></div>
        </div>

        <!-- Insights -->
        <div id="insightsSection" class="content-section" role="tabpanel">
            <h2 class="section-title">Key Metrics Summary</h2>
            <div id="enrollmentInsights" class="insights-container"></div>
            <div id="performanceInsights" class="insights-container"></div>
            <div id="retentionInsights" class="insights-container"></div>
            <div id="demographicInsights" class="insights-container"></div>
            <div id="dataFlags" class="insights-container"></div>
        </div>

        <!-- AI Assistant -->
        <div id="assistantSection" class="content-section" role="tabpanel">
            <h2 class="section-title">AI Assistant</h2>
            <div class="assistant-disclaimer">
                <strong>Disclaimer:</strong> This AI assistant is included for research and experimental purposes only as part of this MSc project. The use of AI tools, including local models such as Ollama, may be subject to institutional policies. All analytical insights in the dashboard are derived from imported data without AI involvement.
            </div>
            <div class="assistant-container">
                <div class="assistant-mode-selector">
                    <button class="assistant-mode active" data-mode="online">Online (API)</button>
                    <button class="assistant-mode" data-mode="local">Local (Ollama)</button>
                </div>
                <div class="assistant-config" id="assistantConfig">
                    <div class="config-online" id="configOnline">
                        <label>API Key</label>
                        <input type="password" id="apiKey" placeholder="sk-...">
                        <label>Model</label>
                        <select id="onlineModel">
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="claude-sonnet-4-5-20250929">Claude Sonnet</option>
                        </select>
                    </div>
                    <div class="config-local" id="configLocal" style="display:none;">
                        <label>Ollama URL</label>
                        <input type="text" id="ollamaUrl" value="http://localhost:11434">
                        <label>Model</label>
                        <input type="text" id="localModel" value="llama3.2">
                    </div>
                </div>
                <div class="chat-container" id="chatContainer">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input-row">
                        <textarea id="chatInput" placeholder="Ask about the data..." rows="2"></textarea>
                        <button class="btn btn-primary" id="chatSend">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="dashboard-footer">
            <p>MSc Data Science Project | Student Performance Analytics</p>
        </footer>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Loading dashboard...</p>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/dataLoader.js"></script>
    <script src="js/dataStore.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/tables.js"></script>
    <script src="js/queryPanel.js"></script>
    <script src="js/insights.js"></script>
    <script src="js/assistant.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
