name: Dashboard Deployment Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Check file structure
      run: |
        echo "Checking required files..."
        
        if [ ! -f "index.html" ]; then
          echo "❌ Missing index.html"
          exit 1
        fi
        
        if [ ! -f "css/dashboard.css" ]; then
          echo "❌ Missing css/dashboard.css"
          exit 1
        fi
        
        if [ ! -d "js" ]; then
          echo "❌ Missing js directory"
          exit 1
        fi
        
        if [ ! -d "data" ]; then
          echo "⚠️  Warning: data directory not found (you may need to add your CSV files)"
        fi
        
        echo "✅ All required files present"
    
    - name: Validate CSV files (if present)
      run: |
        if [ -d "data" ]; then
          echo "Checking CSV files..."
          
          if [ -f "data/students.csv" ]; then
            echo "✅ students.csv found"
          else
            echo "⚠️  students.csv not found"
          fi
          
          if [ -f "data/enrollments.csv" ]; then
            echo "✅ enrollments.csv found"
          else
            echo "⚠️  enrollments.csv not found"
          fi
          
          if [ -f "data/grades.csv" ]; then
            echo "✅ grades.csv found"
          else
            echo "⚠️  grades.csv not found"
          fi
        fi
    
    - name: Check JavaScript syntax
      run: |
        echo "Checking JavaScript files..."
        for file in js/*.js; do
          if [ -f "$file" ]; then
            # Basic syntax check - looks for obvious errors
            if node -c "$file" 2>/dev/null || node --check "$file" 2>/dev/null; then
              echo "✅ $file syntax OK"
            else
              echo "⚠️  Could not validate $file (node not available in CI)"
            fi
          fi
        done
    
    - name: Deployment ready
      run: |
        echo "================================"
        echo "✅ Dashboard is ready to deploy!"
        echo "================================"
        echo ""
        echo "Your dashboard will be available at:"
        echo "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "Make sure GitHub Pages is enabled in repository settings."
